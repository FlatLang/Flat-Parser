package flat/parser

import flat/datastruct/HashMap
import flat/parser/Parser
import flat/ast/FileNode
import flat/ast/ImportNode
import flat/compiler/models/Token
import flat/io/File

testable class {
  async test `can parse import declaration`() {
    let parser = ImportParser()

    let match = GroupTokenMatch(tokenMatches: [
      SingleTokenMatch(
        tokens: [Token(value: "flat", type: Token.Type.IDENTIFIER)],
        label: "import_location_component"
      ),
      SingleTokenMatch(
        tokens: [Token(value: "/", type: Token.Type.SYMBOL)],
        label: "import_location_component"
      ),
      SingleTokenMatch(
        tokens: [Token(value: "thing", type: Token.Type.IDENTIFIER)],
        label: "import_location_component"
      ),
      SingleTokenMatch(
        tokens: [Token(value: "/", type: Token.Type.SYMBOL)],
        label: "import_location_component"
      ),
      SingleTokenMatch(
        tokens: [Token(value: "test", type: Token.Type.IDENTIFIER)],
        label: "import_location_component"
      )
    ])

    let result = parser.generateNode(null, match)

    let expected = ImportNode(location: "flat/thing/test")

    expect(result).toBe(expected)
  }

  async test `can parse single letter import declaration`() {
    let parser = ImportParser()

    let match = GroupTokenMatch(tokenMatches: [
      SingleTokenMatch(
        tokens: [Token(value: "a", type: Token.Type.IDENTIFIER)],
        label: "import_location_component"
      )
    ])

    let result = parser.generateNode(null, match)

    let expected = ImportNode(location: "a")

    expect(result).toBe(expected)
  }
}
